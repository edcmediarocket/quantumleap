
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Daily Signals: Publicly readable, only backend can write.
    match /dailySignals/{signalId} {
      allow read: if true;
      allow write: if false; // Writes should come from backend/admin functions
    }

    // Admin Settings (e.g., Feature Toggles)
    // - featureToggles document is publicly readable for app config
    // - Only specific admin UID can write to any document in adminSettings
    match /adminSettings/featureToggles {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1';
    }
    match /adminSettings/{settingId} {
      allow read: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1'; // Only admin can read other settings
      allow write: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1';
    }

    // User-specific data (e.g., preferences, FCM tokens)
    // Users can read and write their own data.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Example: User preferences subcollection
      match /preferences/{prefId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      // Add other subcollections for the user if needed
    }

    // Coach Logs: Allow authenticated users to create logs (via backend function passing UID).
    // Only admin can read all logs. Users should not typically read these directly.
    match /coachLogs/{logId} {
      allow create: if request.auth != null; // Assumes backend function authenticates and passes UID
      allow read: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1';
      allow update, delete: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1'; // Only admin can modify/delete
    }

    // Fallback: Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
