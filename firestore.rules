
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Admin settings (e.g., feature toggles at /adminSettings/featureToggles)
    // - Publicly readable
    // - Writable only by the specified admin UID
    match /adminSettings/{adminDocId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1';
    }

    // Daily signals
    // - Publicly readable (this covers queries on the collection, e.g., by DailySignalsPanel)
    // - Not writable from the client (only by backend functions)
    match /dailySignals/{signalDoc=**} {
      allow read: if true;
      allow write: if false;
    }

    // Coach logs
    // - Readable by admin (this covers queries/reads on the collection)
    // - Not writable from the client (only by backend functions)
    match /coachLogs/{logDoc=**} {
      allow read: if request.auth != null && request.auth.uid == 'qRJOtYXWqLbpQ1yx6qRdwSGwGyl1';
      allow write: if false;
    }

    // User-specific data (e.g., preferences, fcmTokens stored under /users/{userId}/...)
    // - Users can read and write their own data.
    match /users/{userId}/{userDoc=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Default deny all other access.
    // This rule is crucial and must be the last one for non-explicitly matched paths.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
